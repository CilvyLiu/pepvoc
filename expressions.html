<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nova's Express Lab | å¸¸ç”¨è¡¨è¾¾</title>
    <style>
        :root { --primary: #4D96FF; --bg: #F8F9FA; }
        body { 
            font-family: 'Comic Sans MS', 'system-ui', sans-serif; 
            background: var(--bg); margin: 0; padding: 20px; text-align: center; 
            -webkit-font-smoothing: antialiased;
        }
        
        .header { 
            background: white; padding: 20px; border-radius: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; 
            position: sticky; top: 10px; z-index: 100; 
        }
        h1 { margin: 0 0 15px 0; font-size: 24px; color: #333; }

        select { 
            padding: 12px 20px; border-radius: 50px; border: 2px solid var(--primary); 
            font-size: 18px; outline: none; cursor: pointer; background: white;
            appearance: none; -webkit-appearance: none; /* ç»Ÿä¸€ç§»åŠ¨ç«¯å¤–è§‚ */
        }

        .sentence-list { max-width: 600px; margin: 0 auto; display: flex; flex-direction: column; gap: 15px; }
        
        .phrase-card {
            background: white; padding: 20px; border-radius: 15px; text-align: left;
            cursor: pointer; transition: 0.2s; border-left: 6px solid var(--primary);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); 
            -webkit-tap-highlight-color: transparent; /* ç§»é™¤ç§»åŠ¨ç«¯ç‚¹å‡»é˜´å½± */
        }
        .phrase-card:active { transform: scale(0.98); background: #f0f7ff; }
        
        .en { font-size: 19px; font-weight: bold; color: var(--primary); display: block; margin-bottom: 8px; line-height: 1.3; }
        .zh { font-size: 15px; color: #666; font-weight: 500; }
        .scene-tag { float: right; font-size: 11px; background: #f0f0f0; padding: 3px 10px; border-radius: 10px; color: #999; text-transform: uppercase; }

        .back-home { margin: 40px 0; display: inline-block; color: #888; text-decoration: none; font-size: 14px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="header">
        <h1>ğŸ—£ï¸ è¡¨è¾¾å®éªŒå®¤</h1>
        <select id="unitSelector" onchange="changeUnit()">
            <option value="unit1">Unit 1: Hello!</option>
            <option value="unit2">Unit 2: Family</option>
            <option value="unit3">Unit 3: Zoo</option>
            <option value="unit4">Unit 4: Farm</option>
            <option value="unit5">Unit 5: Colours</option>
            <option value="unit6">Unit 6: Birthday</option>
        </select>
    </div>

    <div class="sentence-list" id="list">
        </div>

    <a href="index.html" class="back-home">ğŸ  è¿”å›ä¸»é¡µ</a>

    <script>
        let allData = {};
        
        // æ ¸å¿ƒå‘éŸ³å¼•æ“
        function speak(text) {
            // 1. å°è¯•åœ¨çº¿æ ‡å‡†è‹±éŸ³ (Type 2 ä¸ºæœ‰é“æ ‡å‡†è‹±éŸ³)
            const audioUrl = `https://dict.youdao.com/dictvoice?audio=${encodeURIComponent(text)}&type=2`;
            const audio = new Audio(audioUrl);
            
            const playPromise = audio.play();
            
            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    // 2. å…œåº•æ–¹æ¡ˆï¼šä½¿ç”¨æ‰‹æœºå†…ç½® TTS å¼•æ“
                    window.speechSynthesis.cancel(); // åœæ­¢å½“å‰æ­£åœ¨è¯´çš„
                    const speech = new SpeechSynthesisUtterance(text);
                    speech.lang = 'en-GB'; // å¼ºåˆ¶è‹±å›½è‹±è¯­
                    speech.rate = 0.85;    // ç¨å¾®æ”¾æ…¢ï¼Œé€‚åˆ8å²å­©å­
                    speech.pitch = 1.0;
                    window.speechSynthesis.speak(speech);
                });
            }
        }

        // ç§»åŠ¨ç«¯éŸ³é¢‘ç¯å¢ƒè§£é”
        function unlockAudioContext() {
            const silent = new SpeechSynthesisUtterance("");
            window.speechSynthesis.speak(silent);
            document.removeEventListener('touchstart', unlockAudioContext);
            document.removeEventListener('click', unlockAudioContext);
        }
        document.addEventListener('touchstart', unlockAudioContext);
        document.addEventListener('click', unlockAudioContext);

        async function loadData() {
            try {
                const res = await fetch('expressions_data.json');
                allData = await res.json();
                changeUnit();
            } catch (e) {
                console.error("æ•°æ®åŠ è½½å¤±è´¥:", e);
                document.getElementById('list').innerHTML = "<p>æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ expressions_data.json æ˜¯å¦å­˜åœ¨</p>";
            }
        }

        function changeUnit() {
            const unit = document.getElementById('unitSelector').value;
            const list = document.getElementById('list');
            const data = allData[unit];

            if (!data) return;

            list.innerHTML = "";
            data.forEach(item => {
                const card = document.createElement('div');
                card.className = 'phrase-card';
                // è§£å†³ iOS ç‚¹å‡»å»¶è¿Ÿé—®é¢˜
                card.onclick = () => speak(item.en);
                
                card.innerHTML = `
                    <span class="scene-tag">${item.scene || 'æ—¥å¸¸'}</span>
                    <span class="en">${item.en}</span>
                    <span class="zh">${item.zh}</span>
                `;
                list.appendChild(card);
            });
            window.scrollTo(0, 0);
        }

        loadData();
    </script>
</body>
</html>
