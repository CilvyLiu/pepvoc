<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nova's Junior Lab | å…¨é€šå…³æµ‹éªŒ</title>
    <style>
        :root { --primary: #4D96FF; --success: #6BCB77; --bg: #F0F2F5; }
        body { font-family: system-ui, sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        .quiz-container { background: white; width: 100%; max-width: 500px; border-radius: 24px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-top: 20px; }
        .progress { color: #888; font-size: 14px; margin-bottom: 10px; font-weight: bold; }
        
        #question-box { font-size: 24px; font-weight: bold; color: #2D3436; margin-bottom: 20px; }
        
        .options-grid { display: grid; gap: 12px; }
        .option-btn { 
            background: #F8F9FA; border: 2px solid #EEE; padding: 15px; border-radius: 15px; 
            text-align: left; font-size: 18px; cursor: pointer; transition: 0.2s;
            -webkit-tap-highlight-color: transparent;
        }
        .option-btn:active { transform: scale(0.98); }
        .option-btn.correct { background: var(--success); color: white; border-color: var(--success); }
        .option-btn.wrong { background: #FF6B6B; color: white; border-color: #FF6B6B; }

        .score-panel { text-align: center; display: none; }
        .score-val { font-size: 60px; color: var(--primary); font-weight: 900; }
        .btn-restart { background: var(--primary); color: white; border: none; padding: 15px 40px; border-radius: 50px; font-size: 18px; margin-top: 20px; cursor: pointer; }
    </style>
</head>
<body>

    <h1>ğŸš€ å…¨æ¯æµ‹éªŒä¸­å¿ƒ</h1>

    <div class="quiz-container" id="quiz-ui">
        <div class="progress">Question <span id="current-idx">1</span> / <span id="total-idx">?</span></div>
        <div id="question-box">åŠ è½½ä¸­...</div>
        <div class="options-grid" id="options"></div>
    </div>

    <div class="quiz-container score-panel" id="score-ui">
        <h2>ğŸ‰ æµ‹éªŒå®Œæˆ!</h2>
        <div class="score-val" id="final-score">0</div>
        <p id="score-msg"></p>
        <button class="btn-restart" onclick="location.reload()">é‡æ–°å¼€å§‹</button>
        <br>
        <button class="btn-restart" style="background:#2D3436" onclick="location.href='index.html'">è¿”å›é¦–é¡µ</button>
    </div>

    <script>
        let allWords = [];
        let currentQuestion = 0;
        let score = 0;

        // 1. å¹¶å‘æŠ“å–æ‰€æœ‰å•å…ƒçš„æ•°æ®
        async function loadAllData() {
            const units = [1, 2, 3, 4, 5, 6];
            try {
                const promises = units.map(u => fetch(`./unit${u}/data.json`).then(r => r.json()));
                const results = await Promise.all(promises);
                allWords = results.flat(); // åˆå¹¶æˆä¸€ä¸ªå¤§æ•°ç»„
                startQuiz();
            } catch (e) {
                document.getElementById('question-box').innerText = "âŒ æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·ç¡®ä¿æ‰€æœ‰ unitX æ–‡ä»¶å¤¹ä¸‹éƒ½æœ‰ data.json";
            }
        }

        function startQuiz() {
            // æ´—ç‰Œï¼šéšæœºæŠ½å– 10 ä¸ªé¢˜ç›®
            allWords.sort(() => Math.random() - 0.5);
            allWords = allWords.slice(0, 10);
            
            document.getElementById('total-idx').innerText = allWords.length;
            showQuestion();
        }

        function showQuestion() {
            const item = allWords[currentQuestion];
            document.getElementById('current-idx').innerText = currentQuestion + 1;
            document.getElementById('question-box').innerText = `â€œ${item.chinese}â€çš„è‹±æ–‡æ˜¯ï¼Ÿ`;
            
            // ç”Ÿæˆå¹²æ‰°é¡¹ï¼šä»åº“é‡ŒéšæœºæŠ“ 3 ä¸ªä¸åŒçš„è¯
            let distractors = allWords
                .filter(w => w.word !== item.word)
                .sort(() => Math.random() - 0.5)
                .slice(0, 3)
                .map(w => w.word);
            
            let choices = [...distractors, item.word].sort(() => Math.random() - 0.5);
            
            const optionsDiv = document.getElementById('options');
            optionsDiv.innerHTML = "";
            
            choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = choice;
                btn.onclick = () => checkAnswer(choice, item.word, btn);
                optionsDiv.appendChild(btn);
            });
        }

        function checkAnswer(selected, correct, btn) {
            // ç¦ç”¨æ‰€æœ‰æŒ‰é’®é˜²æ­¢è¿ç‚¹
            document.querySelectorAll('.option-btn').forEach(b => b.onclick = null);

            if (selected === correct) {
                btn.classList.add('correct');
                score += 10;
                // æ’­æ”¾æ­£ç¡®éŸ³æ•ˆæˆ–ç®€å•å‘éŸ³
                speak(correct);
            } else {
                btn.classList.add('wrong');
                // æ‰¾å‡ºæ­£ç¡®çš„é‚£ä¸ªæ ‡ç»¿
                document.querySelectorAll('.option-btn').forEach(b => {
                    if(b.innerText === correct) b.classList.add('correct');
                });
            }

            setTimeout(() => {
                currentQuestion++;
                if (currentQuestion < allWords.length) {
                    showQuestion();
                } else {
                    showResult();
                }
            }, 1200);
        }

        function showResult() {
            document.getElementById('quiz-ui').style.display = 'none';
            document.getElementById('score-ui').style.display = 'block';
            document.getElementById('final-score').innerText = score;
            document.getElementById('score-msg').innerText = score >= 80 ? "å¤ªæ£’äº†ï¼ŒNovaï¼ä½ æ˜¯è¯æ±‡å¤§å¸ˆï¼" : "å†æ¥å†å‰ï¼Œå¤šå›å•å…ƒé‡Œå¬å¬å‘éŸ³å“¦ï¼";
        }

        function speak(text) {
            const speech = new SpeechSynthesisUtterance(text);
            speech.lang = 'en-GB';
            window.speechSynthesis.speak(speech);
        }

        loadAllData();
    </script>
</body>
</html>
